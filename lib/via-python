# vim:set ft=sh sw=4 sts=4 et:

# Data-driven game-data-packager code for Jedi Outcast, Jedi Academy,
# Return to Castle Wolfenstein; hopefully generalizable to others.
#
# Must define SHORTNAME, LONGNAME first.

gdp_data_driven () {
    if [ "$*" = "" ]; then
        set _ --help
        shift
    fi

    (
    export ETCDIR
    export DATADIR
    export OUTDIR
    export WORKDIR
    PYTHONPATH="$LIBDIR"
    export PYTHONPATH
    if [ -n "${DEBUG:-}" ]; then
        export DEBUG
    fi
    if [ "$INSTALL" = "yes" ]; then
        set _ --install "$@"
    else
        set _ --no-install "$@"
    fi
    shift
    if [ "$COMPRESS" = "yes" ]; then
        set _ --compress "$@"
    else
        set _ --no-compress "$@"
    fi
    shift
    if [ "$PRESERVE" = "yes" ]; then
        set _ -d "$OUTDIR" "$@"
        shift
    fi
    debug "Packaging $LONGNAME via Python code"
    debug "Will run: python3 -m game_data_packager $SHORTNAME $*"
    python3 -m game_data_packager "$@"
    exit $?
    )

    if [ "$?" != 0 ]; then
        exit $?
    fi

    # Special value to signal that gdp should just install every .deb
    # in $WORKDIR
    OUTFILE="*.deb"

    # The Python code does the installation if necessary, so we don't
    # need to deal with this in shell script any more
    INSTALL=no
}

go () {
    gdp_data_driven "$SHORTNAME" "$@"
}
